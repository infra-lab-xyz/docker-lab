version: '2'
services:
  consul-node-1:
    container_name: consul-cluster-node-1
    image: consul:1.2.2
    restart: always
    logging:
      driver: journald
      options:
        tag: consul.node0.prod
    networks:
      default:
        aliases:
          - consul-node-1
        ipv4_address: 192.168.4.2
    ports:
      - "127.0.0.1:18500:8500"
    volumes:
      - "/home/yshutkin/develop/common/docker-lab/vault-cluster/configs/consul-cluster-node-1.json:/consul/config/server.json:ro"
      - "/home/yshutkin/develop/common/docker-lab/vault-cluster/data/consul-cluster-node-1:/consul/data:rw"
    command: ["consul", "agent", "-config-dir", "/consul/config/"]
  
  consul-node-2:
    container_name: consul-cluster-node-2
    image: consul:1.2.2
    restart: always
    logging:
      driver: journald
      options:
        tag: consul.node0.prod
    networks:
      default:
        aliases:
          - consul-node-2
        ipv4_address: 192.168.4.3
    volumes:
      - "/home/yshutkin/develop/common/docker-lab/vault-cluster/configs/consul-cluster-node-2.json:/consul/config/server.json:ro"
      - "/home/yshutkin/develop/common/docker-lab/vault-cluster/data/consul-cluster-node-2:/consul/data:rw"
    command: ["consul", "agent", "-config-dir", "/consul/config/"]
    
  consul-node-3:
    container_name: consul-cluster-node-3
    image: consul:1.2.2
    restart: always
    logging:
      driver: journald
      options:
        tag: consul.node0.prod
    networks:
      default:
        aliases:
          - consul-node-3
        ipv4_address: 192.168.4.4
    volumes:
      - "/home/yshutkin/develop/common/docker-lab/vault-cluster/configs/consul-cluster-node-3.json:/consul/config/server.json:ro"
      - "/home/yshutkin/develop/common/docker-lab/vault-cluster/data/consul-cluster-node-3:/consul/data:rw"
    command: ["consul", "agent", "-config-dir", "/consul/config/"]

  vault-client-1:
    image: vault-consul-client:1.0.0
    container_name: vault-client-1
    cap_add:
      - IPC_LOCK
    networks:
      default:
        aliases:
          - vault-client-1
        ipv4_address: 192.168.4.6
    volumes:
      - "/home/yshutkin/develop/common/docker-lab/vault-cluster/configs/consul-agent-node-1.json:/consul/config/server.json:ro"
      - "/home/yshutkin/develop/common/docker-lab/vault-cluster/configs/vault-config-node-1.hcl:/vault/config/config.hcl:ro"
    ports:
      - "127.0.0.1:20201:8200"

  vault-client-2:
    image: vault-consul-client:1.0.0
    container_name: vault-client-2
    cap_add:
      - IPC_LOCK
    networks:
      default:
        aliases:
          - vault-client-1
        ipv4_address: 192.168.4.7
    volumes:
      - "/home/yshutkin/develop/common/docker-lab/vault-cluster/configs/consul-agent-node-2.json:/consul/config/server.json:ro"
      - "/home/yshutkin/develop/common/docker-lab/vault-cluster/configs/vault-config-node-2.hcl:/vault/config/config.hcl:ro"
    ports:
      - "127.0.0.1:20202:8200"

  vault-client-3:
    image: vault-consul-client:1.0.0
    container_name: vault-client-3
    cap_add:
      - IPC_LOCK
    networks:
      default:
        aliases:
          - vault-client-3
        ipv4_address: 192.168.4.8
    volumes:
      - "/home/yshutkin/develop/common/docker-lab/vault-cluster/configs/consul-agent-node-3.json:/consul/config/server.json:ro"
      - "/home/yshutkin/develop/common/docker-lab/vault-cluster/configs/vault-config-node-3.hcl:/vault/config/config.hcl:ro"
    ports:
      - "127.0.0.1:20203:8200"

networks:
  default:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 192.168.4.0/26
        gateway: 192.168.4.1

